apply plugin: 'com.android.application'

android {
    compileSdkVersion 25
    buildToolsVersion "25.0.2"

    defaultConfig {
        applicationId "com.github.yeriomin.yalpstore"
        minSdkVersion 5
        targetSdkVersion 25
        versionCode 13
        versionName "0.13"
    }
    buildTypes {
        release {
            shrinkResources true
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
        debug {
            shrinkResources true
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    lintOptions {
        warning 'MissingTranslation'
        disable 'GoogleAppIndexingWarning','GoogleAppIndexingApiWarning'
    }

    def otaDir = "${project.rootDir}/yalp-store-ota-zip"
    def apkFilename = "YalpStore.apk"
    task downloadYalpStoreApk() {
        def f = new File("${project.buildDir}/${apkFilename}")
        def url = "https://f-droid.org/repo/" + android.defaultConfig.applicationId + "_" + android.defaultConfig.versionCode + ".apk"
        if (!f.exists()) {
            println "Downloading ${url}"
            new URL(url).withInputStream { i -> f.withOutputStream { it << i } }
        }
    }
    task createOtaZip (dependsOn: downloadYalpStoreApk, type: Zip) {
        from ("${otaDir}") {
            include ('**')
        }
        from (project.buildDir) {
            include (apkFilename)
        }
        destinationDir project.rootDir
        archiveName 'yalp-store-ota.zip'
    }
    project.tasks.build.dependsOn createOtaZip
}

dependencies {
    compile 'com.github.yeriomin:play-store-api:0.13'
    compile 'eu.chainfire:libsuperuser:1.0.0.201608240809'
}
